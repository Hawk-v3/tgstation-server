#!/usr/bin/make -f

export DH_VERBOSE = 1

%:
		dh $@

override_dh_auto_clean:
		rm -rf artifacts
		dotnet clean -c ReleaseNoService

override_dh_auto_build:
		dotnet restore
		cd src/Tgstation.Server.Host.Console && dotnet publish -c Release -o ../../artifacts
		cd src/Tgstation.Server.Host && dotnet publish -c Release -o ../../artifacts/lib/Default
		mv artifacts/lib/Default/appsettings.yml artifacts/appsettings.yml
		rm artifacts/lib/Default/Tgstation.Server.Host
		rm artifacts/Tgstation.Server.Host.Console

override_dh_auto_install:
		cp build/package/deb/MakeInstall ./Makefile
		dh_auto_install --

override_dh_strip:

override_dh_shlibdeps:

override_dh_installsystemd:
	dh_installsystemd -v --restart-after-upgrade
